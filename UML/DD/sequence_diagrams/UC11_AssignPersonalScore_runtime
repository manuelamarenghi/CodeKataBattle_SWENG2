// Suppose that the educator can assign a personal score, the battle is in the consolidation phase and the educator is also the creator of the battle and submits a correct score
frame Submit a personal evaluation

fontawesome6solid f390 WebApp
participant API Gateway
participant Tournament Manager
database Tournament DB
participant Battle Manager
database Battle DB
participantspacing 5

activate WebApp
WebApp->API Gateway: getTournament(id)
activate API Gateway
API Gateway->Tournament Manager: getTournament(id)
activate Tournament Manager

Tournament Manager->Tournament DB: executeQuery(Tournament id)
activate Tournament DB

alt tournament_id_valid == true
Tournament DB-->Tournament Manager: result
Tournament Manager-->API Gateway: result
API Gateway-->WebApp: result
WebApp->API Gateway: getBattle(id)
API Gateway->Battle Manager: getBattle(id)
activate Battle Manager

Battle Manager->Battle DB: executeQuery(Battle id)

activate Battle DB
alt battle_id_valid == true
Battle DB-->Battle Manager: success
Battle Manager-->API Gateway: result
API Gateway-->WebApp: result
deactivate Battle Manager

WebApp->API Gateway: getTeams(id battle)
API Gateway->Battle Manager: getTeams(id battle)
activate Battle Manager
Battle Manager->Battle DB: executeQuery(Battle id)
Battle DB-->Battle Manager: result
Battle Manager-->API Gateway: result
API Gateway-->WebApp: result

WebApp->API Gateway: assignPersonalScore(id team, score)
API Gateway->Battle Manager: assignPersonalScore(id team, score)
// Query to update the score of students
Battle Manager->Battle DB: executeQuery()
else
Battle DB->Battle Manager: invalid_id
deactivate Battle DB
end

Battle Manager-->API Gateway: result
deactivate Battle Manager
API Gateway-->WebApp: result

else 
Tournament DB-->Tournament Manager: invalid_id
deactivate Tournament DB
Tournament Manager-->API Gateway: result
deactivate Tournament Manager
API Gateway-->WebApp: result
end

